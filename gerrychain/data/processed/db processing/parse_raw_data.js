let patterns = {
  chain445: {
    polsby_popper_scores: {
      1: 0.23861483004655376,
      2: 0.22298870577859975,
      3: 0.1750177787524177,
    },
    dem_splits: {
      0: 0.5037128648363732,
      1: 0.5027651556598813,
      2: 0.4993076889401883,
    },
    rep_splits: {
      0: 0.49628713516362677,
      1: 0.4972348443401187,
      2: 0.5006923110598118,
    },
    black_pop: {
      1: 696748.6,
      2: 761190.2,
      3: 561915.2,
    },
    asian_pop: {
      1: 67800.4,
      2: 74000.2,
      3: 64778.4,
    },
    hisp_pop: {
      1: 271415.4,
      2: 269905.7,
      3: 258798.9,
    },
    white_pop: {
      1: 2090266.5,
      2: 2017922.4,
      3: 2115806.1,
    },
    total_pop: {
      1: 3219624.6,
      2: 3225193.5,
      3: 3090664.9,
    },
    minority_pop: {
      1: 1035964.4,
      2: 1105096.1,
      3: 885492.5,
    },
    opportunity_reps: 0.0,
    equal_pop: {
      0: 744541.9,
    },
    dem_vote_share_percentage: 0.5019285698121475,
    dem_seat_share_percentage: 0.6,
    rep_vote_share_percentage: 0.4980714301878524,
    rep_seat_share_percentage: 0.4,
    black_pop_box_data: {
      1: {
        min: 440187.0,
        "25%": 477903.5,
        "50%": 638614.5,
        mean: 696748.6,
        "75%": 937913.75,
        max: 965426.0,
      },
      2: {
        min: 450728.0,
        "25%": 632666.75,
        "50%": 718684.0,
        mean: 761190.2,
        "75%": 958243.75,
        max: 972106.0,
      },
      3: {
        min: 436858.0,
        "25%": 436858.0,
        "50%": 446776.5,
        mean: 561915.2,
        "75%": 624906.25,
        max: 950964.0,
      },
    },
    asian_pop_box_data: {
      1: {
        min: 47094.0,
        "25%": 64318.25,
        "50%": 64688.0,
        mean: 67800.4,
        "75%": 65779.0,
        max: 89652.0,
      },
      2: {
        min: 51506.0,
        "25%": 70944.0,
        "50%": 75450.0,
        mean: 74000.2,
        "75%": 76963.0,
        max: 94064.0,
      },
      3: {
        min: 48356.0,
        "25%": 65421.0,
        "50%": 65421.0,
        mean: 64778.4,
        "75%": 67108.5,
        max: 72039.0,
      },
    },
    hispanic_pop_box_data: {
      1: {
        min: 233157.0,
        "25%": 236535.75,
        "50%": 257933.5,
        mean: 271415.4,
        "75%": 309940.5,
        max: 322502.0,
      },
      2: {
        min: 218566.0,
        "25%": 244378.5,
        "50%": 260120.5,
        mean: 269905.7,
        "75%": 303476.0,
        max: 317113.0,
      },
      3: {
        min: 236335.0,
        "25%": 236335.0,
        "50%": 238710.5,
        mean: 258798.9,
        "75%": 260675.0,
        max: 348397.0,
      },
    },
    white_pop_box_data: {
      1: {
        min: 1884178.0,
        "25%": 1961977.5,
        "50%": 2102184.0,
        mean: 2090266.5,
        "75%": 2195833.75,
        max: 2269087.0,
      },
      2: {
        min: 1773114.0,
        "25%": 1896687.0,
        "50%": 2011066.5,
        mean: 2017922.4,
        "75%": 2180500.0,
        max: 2207412.0,
      },
      3: {
        min: 1864901.0,
        "25%": 2128253.0,
        "50%": 2128253.0,
        mean: 2115806.1,
        "75%": 2151551.0,
        max: 2348697.0,
      },
    },
    total_pop_box_data: {
      1: {
        min: 2902936.0,
        "25%": 2906329.0,
        "50%": 2945215.0,
        mean: 3219624.6,
        "75%": 3665524.75,
        max: 3693862.0,
      },
      2: {
        min: 2907885.0,
        "25%": 2928294.75,
        "50%": 2981145.0,
        mean: 3225193.5,
        "75%": 3639520.0,
        max: 3673544.0,
      },
      3: {
        min: 2927580.0,
        "25%": 2933736.0,
        "50%": 2933736.0,
        mean: 3090664.9,
        "75%": 2992178.75,
        max: 3672321.0,
      },
    },
    chain445_dem_seats: {
      1: {
        0: 1,
        1: 1,
        2: 2,
        3: 2,
        4: 2,
        5: 2,
        6: 1,
        7: 0,
        8: 2,
        9: 2,
      },
      2: {
        0: 2,
        1: 2,
        2: 1,
        3: 1,
        4: 1,
        5: 1,
        6: 2,
        7: 4,
        8: 1,
        9: 2,
      },
      3: {
        0: 3,
        1: 3,
        2: 3,
        3: 3,
        4: 3,
        5: 3,
        6: 3,
        7: 3,
        8: 3,
        9: 3,
      },
    },
    chain445_rep_seats: {
      1: {
        0: 3,
        1: 3,
        2: 2,
        3: 2,
        4: 2,
        5: 2,
        6: 3,
        7: 4,
        8: 2,
        9: 2,
      },
      2: {
        0: 2,
        1: 2,
        2: 3,
        3: 3,
        4: 3,
        5: 3,
        6: 2,
        7: 0,
        8: 3,
        9: 2,
      },
      3: {
        0: 2,
        1: 2,
        2: 2,
        3: 2,
        4: 2,
        5: 2,
        6: 2,
        7: 2,
        8: 2,
        9: 2,
      },
    },
  },
  chain355: {
    polsby_popper_scores: {
      1: 0.26650955037409074,
      2: 0.19215012891592737,
      3: 0.19213246875419815,
    },
    dem_splits: {
      0: 0.49521219527813604,
      1: 0.5162839044751238,
      2: 0.49267848871974185,
    },
    rep_splits: {
      0: 0.5047878047218639,
      1: 0.48371609552487616,
      2: 0.5073215112802583,
    },
    black_pop: {
      1: 781789.5,
      2: 717931.4,
      3: 520133.1,
    },
    asian_pop: {
      1: 60420.8,
      2: 79633.35,
      3: 66524.85,
    },
    hisp_pop: {
      1: 270726.0,
      2: 272399.1,
      3: 256994.9,
    },
    white_pop: {
      1: 2017034.25,
      2: 2001521.15,
      3: 2205439.6,
    },
    total_pop: {
      1: 3235320.0,
      2: 3171010.7,
      3: 3129152.3,
    },
    minority_pop: {
      1: 1112936.3,
      2: 1069963.85,
      3: 843652.85,
    },
    opportunity_reps: 0.0,
    equal_pop: {
      0: 1098661.3,
    },
    dem_vote_share_percentage: 0.5013915294910005,
    dem_seat_share_percentage: 0.5666666666666667,
    rep_vote_share_percentage: 0.4986084705089994,
    rep_seat_share_percentage: 0.4333333333333333,
    black_pop_box_data: {
      1: {
        min: 440187.0,
        "25%": 607200.25,
        "50%": 876940.0,
        mean: 781789.5,
        "75%": 964631.75,
        max: 1016871.0,
      },
      2: {
        min: 450728.0,
        "25%": 600917.75,
        "50%": 645606.5,
        mean: 717931.4,
        "75%": 865224.75,
        max: 972106.0,
      },
      3: {
        min: 181867.0,
        "25%": 436858.0,
        "50%": 522601.0,
        mean: 520133.1,
        "75%": 545683.0,
        max: 950964.0,
      },
    },
    asian_pop_box_data: {
      1: {
        min: 21237.0,
        "25%": 61085.0,
        "50%": 63063.0,
        mean: 60420.8,
        "75%": 65637.0,
        max: 89652.0,
      },
      2: {
        min: 51506.0,
        "25%": 69103.5,
        "50%": 76277.5,
        mean: 79633.35,
        "75%": 87570.5,
        max: 116249.0,
      },
      3: {
        min: 28694.0,
        "25%": 65421.0,
        "50%": 67000.0,
        mean: 66524.85,
        "75%": 72773.5,
        max: 77866.0,
      },
    },
    hispanic_pop_box_data: {
      1: {
        min: 146433.0,
        "25%": 233157.0,
        "50%": 309761.0,
        mean: 270726.0,
        "75%": 314592.0,
        max: 322502.0,
      },
      2: {
        min: 187022.0,
        "25%": 232962.25,
        "50%": 277798.0,
        mean: 272399.1,
        "75%": 306885.25,
        max: 361340.0,
      },
      3: {
        min: 136826.0,
        "25%": 236335.0,
        "50%": 257863.0,
        mean: 256994.9,
        "75%": 292347.0,
        max: 348397.0,
      },
    },
    white_pop_box_data: {
      1: {
        min: 1332742.0,
        "25%": 1908514.0,
        "50%": 2160060.0,
        mean: 2017034.25,
        "75%": 2165890.25,
        max: 2279387.0,
      },
      2: {
        min: 1370542.0,
        "25%": 1813269.75,
        "50%": 2135253.5,
        mean: 2001521.15,
        "75%": 2216233.0,
        max: 2689073.0,
      },
      3: {
        min: 1372952.0,
        "25%": 2081517.5,
        "50%": 2143785.0,
        mean: 2205439.6,
        "75%": 2559503.0,
        max: 2680740.0,
      },
    },
    total_pop_box_data: {
      1: {
        min: 2147009.0,
        "25%": 2906329.0,
        "50%": 3604857.0,
        mean: 3235320.0,
        "75%": 3688860.0,
        max: 3703821.0,
      },
      2: {
        min: 2194281.0,
        "25%": 2912502.0,
        "50%": 3305796.0,
        mean: 3171010.7,
        "75%": 3652910.0,
        max: 3736132.0,
      },
      3: {
        min: 2122162.0,
        "25%": 2933736.0,
        "50%": 2991330.5,
        mean: 3129152.3,
        "75%": 3652342.0,
        max: 3672321.0,
      },
    },
    chain355_dem_seats: {
      1: {
        0: 0,
        1: 0,
        2: 3,
        3: 0,
        4: 3,
        5: 3,
        6: 3,
        7: 0,
        8: 3,
        9: 3,
      },
      2: {
        0: 2,
        1: 2,
        2: 0,
        3: 1,
        4: 0,
        5: 3,
        6: 3,
        7: 2,
        8: 1,
        9: 3,
      },
      3: {
        0: 4,
        1: 4,
        2: 4,
        3: 4,
        4: 4,
        5: 1,
        6: 0,
        7: 3,
        8: 3,
        9: 1,
      },
    },
    chain355_rep_seats: {
      1: {
        0: 3,
        1: 3,
        2: 0,
        3: 3,
        4: 0,
        5: 0,
        6: 0,
        7: 3,
        8: 0,
        9: 0,
      },
      2: {
        0: 3,
        1: 3,
        2: 5,
        3: 4,
        4: 5,
        5: 2,
        6: 2,
        7: 3,
        8: 4,
        9: 2,
      },
      3: {
        0: 1,
        1: 1,
        2: 1,
        3: 1,
        4: 1,
        5: 4,
        6: 5,
        7: 2,
        8: 2,
        9: 4,
      },
    },
  },
  chain3334: {
    polsby_popper_scores: {
      1: 0.23340522678004605,
      2: 0.187168805766411,
      3: 0.18157770425910533,
      4: 0.17133396626882902,
    },
    dem_splits: {
      0: 0.4892450813827329,
      1: 0.5129568592231684,
      2: 0.5093709350972513,
      3: 0.49105663262595406,
    },
    rep_splits: {
      0: 0.5107549186172671,
      1: 0.4870431407768316,
      2: 0.49062906490274877,
      3: 0.508943367374046,
    },
    black_pop: {
      1: 689673.7333333333,
      2: 682499.3333333334,
      3: 471706.43333333335,
      4: 527923.5,
    },
    asian_pop: {
      1: 56939.23333333333,
      2: 70918.93333333333,
      3: 62504.8,
      4: 48648.1,
    },
    hisp_pop: {
      1: 247628.16666666666,
      2: 252114.03333333333,
      3: 233609.73333333334,
      4: 200304.2,
    },
    white_pop: {
      1: 1869701.6333333333,
      2: 1863289.9333333333,
      3: 1998168.2333333334,
      4: 1478505.6,
    },
    total_pop: {
      1: 2958760.3333333335,
      2: 2961066.3666666667,
      3: 2837443.4,
      4: 2334638.7,
    },
    minority_pop: {
      1: 994241.1333333333,
      2: 1005532.3,
      3: 767820.9666666667,
      4: 776875.8,
    },
    opportunity_reps: 0.0,
    equal_pop: {
      0: 971604.7666666667,
    },
    dem_vote_share_percentage: 0.5023798598931177,
    dem_seat_share_percentage: 0.45,
    rep_vote_share_percentage: 0.49762014010688227,
    rep_seat_share_percentage: 0.38333333333333336,
    black_pop_box_data: {
      1: {
        min: 354928.0,
        "25%": 512680.25,
        "50%": 643221.0,
        mean: 689673.7333333333,
        "75%": 937913.75,
        max: 1016871.0,
      },
      2: {
        min: 450728.0,
        "25%": 544003.25,
        "50%": 643416.0,
        mean: 682499.3333333334,
        "75%": 813515.25,
        max: 972106.0,
      },
      3: {
        min: 181867.0,
        "25%": 381141.0,
        "50%": 436858.0,
        mean: 471706.43333333335,
        "75%": 522601.0,
        max: 950964.0,
      },
      4: {
        min: 355745.0,
        "25%": 409566.75,
        "50%": 571032.0,
        mean: 527923.5,
        "75%": 603785.0,
        max: 645667.0,
      },
    },
    asian_pop_box_data: {
      1: {
        min: 21237.0,
        "25%": 42722.5,
        "50%": 61636.0,
        mean: 56939.23333333333,
        "75%": 65779.0,
        max: 89652.0,
      },
      2: {
        min: 32641.0,
        "25%": 53025.0,
        "50%": 69566.5,
        mean: 70918.93333333333,
        "75%": 76963.0,
        max: 116249.0,
      },
      3: {
        min: 28694.0,
        "25%": 55605.5,
        "50%": 65421.0,
        mean: 62504.8,
        "75%": 70063.25,
        max: 77866.0,
      },
      4: {
        min: 23644.0,
        "25%": 40873.0,
        "50%": 43821.0,
        mean: 48648.1,
        "75%": 67451.25,
        max: 75328.0,
      },
    },
    hispanic_pop_box_data: {
      1: {
        min: 146433.0,
        "25%": 185070.75,
        "50%": 241096.5,
        mean: 247628.16666666666,
        "75%": 311948.5,
        max: 322502.0,
      },
      2: {
        min: 170999.0,
        "25%": 215993.5,
        "50%": 235997.0,
        mean: 252114.03333333333,
        "75%": 302982.5,
        max: 361340.0,
      },
      3: {
        min: 136826.0,
        "25%": 186094.5,
        "50%": 236335.0,
        mean: 233609.73333333334,
        "75%": 289552.75,
        max: 348397.0,
      },
      4: {
        min: 148001.0,
        "25%": 182308.0,
        "50%": 195789.0,
        mean: 200304.2,
        "75%": 209270.0,
        max: 266153.0,
      },
    },
    white_pop_box_data: {
      1: {
        min: 1276123.0,
        "25%": 1575157.0,
        "50%": 1987828.0,
        mean: 1869701.6333333333,
        "75%": 2161970.0,
        max: 2279387.0,
      },
      2: {
        min: 1258222.0,
        "25%": 1385105.0,
        "50%": 1904205.0,
        mean: 1863289.9333333333,
        "75%": 2180500.0,
        max: 2689073.0,
      },
      3: {
        min: 1372952.0,
        "25%": 1587945.25,
        "50%": 2034782.0,
        mean: 1998168.2333333334,
        "75%": 2312165.25,
        max: 2680740.0,
      },
      4: {
        min: 1246430.0,
        "25%": 1274359.0,
        "50%": 1441319.0,
        mean: 1478505.6,
        "75%": 1608279.0,
        max: 1822141.0,
      },
    },
    total_pop_box_data: {
      1: {
        min: 2147009.0,
        "25%": 2263447.0,
        "50%": 2906329.0,
        mean: 2958760.3333333335,
        "75%": 3666857.25,
        max: 3703821.0,
      },
      2: {
        min: 2177835.0,
        "25%": 2286631.0,
        "50%": 2910963.0,
        mean: 2961066.3666666667,
        "75%": 3639520.0,
        max: 3736132.0,
      },
      3: {
        min: 2122162.0,
        "25%": 2234504.0,
        "50%": 2933736.0,
        mean: 2837443.4,
        "75%": 3525220.5,
        max: 3672321.0,
      },
      4: {
        min: 2140104.0,
        "25%": 2179825.0,
        "50%": 2206065.5,
        mean: 2334638.7,
        "75%": 2232306.0,
        max: 2914893.0,
      },
    },
    chain3334_dem_seats: {
      1: {
        0: 0,
        1: 0,
        2: 0,
        3: 0,
        4: 2,
        5: 3,
        6: 3,
        7: 3,
        8: 0,
        9: 0,
      },
      2: {
        0: 0,
        1: 3,
        2: 3,
        3: 3,
        4: 2,
        5: 2,
        6: 3,
        7: 3,
        8: 3,
        9: 2,
      },
      3: {
        0: 3,
        1: 0,
        2: 0,
        3: 0,
        4: 0,
        5: 0,
        6: 0,
        7: 0,
        8: 0,
        9: 0,
      },
      4: {
        0: 4,
        1: 4,
        2: 4,
        3: 4,
        4: 4,
        5: 3,
        6: 1,
        7: 1,
        8: 4,
        9: 4,
      },
    },
    chain3334_rep_seats: {
      1: {
        0: 3,
        1: 3,
        2: 3,
        3: 3,
        4: 1,
        5: 0,
        6: 0,
        7: 0,
        8: 3,
        9: 3,
      },
      2: {
        0: 3,
        1: 0,
        2: 0,
        3: 0,
        4: 1,
        5: 1,
        6: 0,
        7: 0,
        8: 0,
        9: 1,
      },
      3: {
        0: 0,
        1: 3,
        2: 3,
        3: 3,
        4: 3,
        5: 3,
        6: 3,
        7: 3,
        8: 3,
        9: 3,
      },
      4: {
        0: 0,
        1: 0,
        2: 0,
        3: 0,
        4: 0,
        5: 1,
        6: 3,
        7: 3,
        8: 0,
        9: 0,
      },
    },
  },
};

let data = {
  polsby_popper_scores: {
    13: 0.19432690858158946,
    5: 0.19067062674558524,
    9: 0.1910019040676945,
    11: 0.19474679038291842,
    3: 0.19223927048638936,
    1: 0.19782707358717835,
    7: 0.19380548309820045,
    8: 0.18817815978929595,
    10: 0.18876796069848611,
    4: 0.1931606377398913,
    6: 0.1920914726160689,
    12: 0.19204738830377388,
    2: 0.19554927755479715,
  },
  rep_splits: {
    13: 0.5125814660232817,
    5: 0.5103613781818735,
    9: 0.4861806041607154,
    11: 0.5027456686396925,
    3: 0.5046322441855339,
    1: 0.5083608253901655,
    7: 0.5054226853637519,
    8: 0.4863233206361688,
    10: 0.4997377356180684,
    4: 0.4933199062986181,
    6: 0.5072917585661555,
    12: 0.498532332964927,
    2: 0.5095016338145861,
  },
  dem_splits: {
    13: 0.4874185339767183,
    5: 0.48963862181812656,
    9: 0.5138193958392846,
    11: 0.4972543313603075,
    3: 0.49536775581446607,
    1: 0.4916391746098345,
    7: 0.49457731463624816,
    8: 0.5136766793638313,
    10: 0.5002622643819317,
    4: 0.5066800937013819,
    6: 0.4927082414338445,
    12: 0.5014676670350731,
    2: 0.49049836618541376,
  },
  black_pop: {
    13: 150790.1762,
    5: 155661.7046,
    9: 162467.0349,
    11: 135145.6957,
    3: 159826.8004,
    1: 164789.5385,
    7: 152337.5889,
    8: 169070.907,
    10: 160503.3271,
    4: 148640.883,
    6: 146309.0663,
    12: 163461.7739,
    2: 150849.5035,
  },
  asian_pop: {
    13: 15212.7748,
    5: 15108.8547,
    9: 16903.3139,
    11: 16386.0296,
    3: 15920.7771,
    1: 14124.7444,
    7: 15477.8413,
    8: 17115.0242,
    10: 16408.1329,
    4: 16752.3103,
    6: 15948.784,
    12: 15913.5728,
    2: 15306.84,
  },
  hispanic_pop: {
    13: 60128.7161,
    5: 61093.9822,
    9: 63869.3935,
    11: 61048.6783,
    3: 61818.9965,
    1: 59842.8484,
    7: 60373.0769,
    8: 64151.0348,
    10: 62373.49,
    4: 62353.378,
    6: 60578.9314,
    12: 62278.0693,
    2: 60209.4046,
  },
  white_pop: {
    13: 487918.2692,
    5: 477147.3566,
    9: 467989.1523,
    11: 499314.5216,
    3: 473810.9511,
    1: 471675.9361,
    7: 482959.4644,
    8: 461763.8328,
    10: 471262.4603,
    4: 485340.2452,
    6: 490345.0727,
    12: 469912.8557,
    2: 484554.882,
  },
  total_pop: {
    13: 733707.5519,
    5: 733541.4822,
    9: 733662.1486,
    11: 732334.7877,
    3: 733971.6023,
    1: 732436.3253,
    7: 733348.4668,
    8: 734005.8849,
    10: 733441.8091,
    4: 733484.129,
    6: 733858.7175,
    12: 734248.1658,
    2: 733441.9289,
  },
  minority_pop: {
    13: 226131.6671,
    5: 231864.5415,
    9: 243239.7423,
    11: 212580.4036,
    3: 237566.574,
    1: 238757.1313,
    7: 228188.5071,
    8: 250336.966,
    10: 239284.95,
    4: 227746.5713,
    6: 222836.7817,
    12: 241653.416,
    2: 226365.7481,
  },
};

//for every pattern, save the average of each field except the ones that have the word "boxdata" in them or aren't objects
function averageFields(patterns) {
  let averages = {};
  for (let pattern in patterns) {
    let patternData = patterns[pattern];
    let patternAverages = {};
    for (let field in patternData) {
      if (
        typeof patternData[field] !== "object" ||
        field.includes("box_data")
      ) {
        patternAverages[field] = patternData[field];
        continue;
      }
      let sum = 0;
      let count = 0;
      for (let district in patternData[field]) {
        sum += patternData[field][district];
        count++;
      }
      patternAverages[field] = sum / count;
    }
    averages[pattern] = patternAverages;
  }
  return averages;
}

//take the average of each district in the dem and rep seats
function averageSeats(patterns) {
  //get all objects that have the word "seats" in them
  let seatObjects = [];
  for (let pattern in patterns) {
    let patternData = patterns[pattern];
    let patternSeats = {};
    for (let field in patternData) {
      if (field.includes("seats")) {
        field.includes("dem")
          ? (patternSeats["dem_seats"] = patternData[field])
          : (patternSeats["rep_seats"] = patternData[field]);

        //if the length of pattern seats is 2, we have both dem and rep seats
        if (Object.keys(patternSeats).length === 2) {
          patternSeats["pattern"] = pattern;
          seatObjects.push(patternSeats);
          break;
        }
      }
    }
  }
  //for each set of seats, average the dem and rep seats for each district
  let averages = {};
  for (let seats of seatObjects) {
    let demSeats = seats.dem_seats;
    let repSeats = seats.rep_seats;
    let demAverages = {};
    let repAverages = {};

    for (let district in demSeats) {
      let demSum = 0;
      let demCount = 0;
      let repSum = 0;
      let repCount = 0;
      for (let iteration in demSeats[district]) {
        demSum += demSeats[district][iteration];
        demCount++;
        repSum += repSeats[district][iteration];
        repCount++;
      }

      demAverages[district] = demSum / demCount;
      repAverages[district] = repSum / repCount;
    }
    let dem_field = seats.pattern + "_dem_seats";
    let rep_field = seats.pattern + "_rep_seats";
    //add the averages to the averages object with the field name being the pattern name
    averages[dem_field] = demAverages;
    averages[rep_field] = repAverages;
  }
  return averages;
}

function convertPatterns(patterns) {
  let newPatterns = averageFields(patterns);
  let newSeats = averageSeats(patterns);

  //for each new seat object, overwrite the old seat object
  for (let pattern in newPatterns) {
    //add new field called planType and totalDistrictPlans
    for (let field in newSeats) {
      if (field.includes(pattern)) {
        newPatterns[pattern][field] = newSeats[field];
      }
    }

    let patternData = newPatterns[pattern];
    for (let field in patternData) {
      //rename fields
      //convert all fields to camel case
      let newField = field
        .split("_")
        .map((word, index) => {
          if (index === 0) return "avg" + word[0].toUpperCase() + word.slice(1);
          return word[0].toUpperCase() + word.slice(1);
        })
        .join("");
      newPatterns[pattern][newField] = patternData[field];
      delete newPatterns[pattern][field];
    }
  }

  //convert the new patterns object to an array
  let patternArray = [];
  for (let pattern in newPatterns) {
    newPatterns[pattern]["planType"] = "MMD";
    newPatterns[pattern]["totalDistrictPlans"] = 10000;
    newPatterns[pattern]["pattern"] = pattern;

    patternArray.push(newPatterns[pattern]);
  }
  return patternArray;
}

function castCategory(category) {
  if (
    category.toLowerCase().includes("black") ||
    category.toLowerCase().includes("blk_")
  )
    return "BLACK";
  if (
    category.toLowerCase().includes("hispanic") ||
    category.toLowerCase().includes("hsp_")
  )
    return "HISPANIC";
  if (
    category.toLowerCase().includes("asian") ||
    category.toLowerCase().includes("asn_")
  )
    return "ASIAN";
  if (
    category.toLowerCase().includes("white") ||
    category.toLowerCase().includes("wt_")
  )
    return "WHITE";
  return category;
}

function separateBoxPlots(patterns) {
  let newPatternsBoxPlots = [];
  for (let pattern of newPatterns) {
    let newPattern = {};
    newPattern["pattern"] = pattern.pattern;
    for (let field in pattern) {
      if (field.toLowerCase().includes("boxdata")) {
        let newField = castCategory(field);
        newPattern[newField] = pattern[field];
        delete pattern[field];
      }
    }
    newPatternsBoxPlots.push(newPattern);
  }
  return newPatternsBoxPlots;
}

// let newPatterns = convertPatterns(patterns);
// let newPatternsBoxPlots= separateBoxPlots(newPatterns);

// console.log(JSON.stringify(newPatterns));
// console.log();
// console.log(JSON.stringify(newPatternsBoxPlots));
//console.log(JSON.stringify(newPatterns));

/////////////////////////////////////////////////////////////
//New code parsing
//import fs here
let fs = require("fs");
let uniqueDistrictPlanIdCounter = 0;

let rawSMDData = JSON.parse(
  fs.readFileSync("../north carolina/nc smd data.json")
);
let rawMMDData = JSON.parse(
  fs.readFileSync("../north carolina/nc mmd data.json")
);
//get all the objects in the "all_data" field
let rawMMDSubEnsembles = rawMMDData.all_data;

let fieldsToAvg = [
  "polsby_popper_scores",
  "rep_splits",
  "dem_splits",
  "opportunity_reps",
  "equal_pop",
];

function getEnsembleSummaryData(rawData, fieldsToAvg, pattern, planType) {
  let SMDSummaryData = {};

  for (let field of fieldsToAvg) {
    let sum = 0;
    let count = 0;
    //if field's value is 0, then save it as is
    if (rawData[field] === 0) {
      SMDSummaryData[field] = 0;
      continue;
    }

    for (let district in rawData[field]) {
      sum += rawData[field][district];
      count++;
    }
    SMDSummaryData[field] = sum / count;
  }
  SMDSummaryData = convertFieldsToCamelCase(SMDSummaryData, "avg");
  SMDSummaryData["planType"] = planType === undefined ? "SMD" : planType;
  SMDSummaryData["totalDistrictPlans"] = 10000;
  SMDSummaryData["pattern"] = pattern === undefined ? "SMD" : pattern;
  return SMDSummaryData;
}

function convertFieldsToCamelCase(object, prefixWord) {
  let newObject = {};
  for (let field in object) {
    let newField = field
      .split("_")
      .map((word, index) => {
        if (index === 0) {
          if (prefixWord === undefined)
            return word[0].toLowerCase() + word.slice(1);
          else return prefixWord + word[0].toUpperCase() + word.slice(1);
        }
        return word[0].toUpperCase() + word.slice(1);
      })
      .join("");
    newObject[newField] = object[field];
  }
  return newObject;
}

let fieldsToAnalyze = [
  "black_pop_box_data",
  "white_pop_box_data",
  "asian_pop_box_data",
  "hispanic_pop_box_data",
];

function getAnalysisData(rawData, fieldsToAnalyze, pattern) {
  let analysisData = {};
  analysisData["boxAndWhiskerPlots"] = {};
  for (let field of fieldsToAnalyze) {
    let newField = castCategory(field);
    if (field.toLowerCase().includes("box_data")) {
      analysisData["boxAndWhiskerPlots"][newField] = rawData[field];
    } else analysisData[newField] = rawData[field];
  }

  ////////STUBS FOR MISSING DATA
  analysisData["voteSeatSharePercentages"] = {};
  analysisData["demRepSplitCounts"] = [];
  analysisData["opportunityRepCounts"] = [];
  analysisData["pattern"] = pattern === undefined ? "SMD" : pattern;
  return analysisData;
}

function getUniquePlansData(rawData, state, planType) {
  let rawUniquePlans = rawData["unique_plans_data"];
  let uniquePlansData = {};
  uniquePlansData["uniqueDistrictPlans"] = [];
  for (let plan in rawUniquePlans) {
    let newPlan = {};
    newPlan["planType"] = planType === undefined ? "SMD" : planType;
    newPlan["description"] = plan;
    newPlan["shape"] = "polygon";
    newPlan["id"] = uniqueDistrictPlanIdCounter++;

    plan = rawUniquePlans[plan]; //convert plan from string to object

    let overview = {};
    overview["state"] = state;
    overview["opportunityDistricts"] = plan["opportunity_reps"];
    overview["safeDistricts"] = plan["safe_districts"];
    //avg polsby popper score
    overview["polsbyPopperScore"] = Object.values(
      plan["polsby_popper_scores"]
    ).reduce((a, b) => a + b, 0);
    overview["polsbyPopperScore"] /= Object.keys(
      plan["polsby_popper_scores"]
    ).length;
    newPlan["overview"] = overview;

    let numDistricts = Object.keys(plan["tot_pop"]).length;
    //create a map with district number as key and district data as value
    let districtMap = {};
    for (let i = 0; i < numDistricts; i++) {
      districtMap[i + 1] = {};
      districtMap[i + 1]["populations"] = [];
    }
    let fieldsToParse = [
      "blk_pop",
      "wt_pop",
      "asn_pop",
      "hsp_pop",
      "rep_split",
      "dem_split",
    ];
    //for each field to parse, map the number key to the numbered district
    for (let field of fieldsToParse) {
      for (let district in plan[field]) {
        if (field === "rep_split" || field === "dem_split") {
          //need to adjust offset in file
          let newDistrictId =
            planType === "MMD" ? Number(district) + 1 + "" : district;
          let newField = field === "rep_split" ? "repSplit" : "demSplit";
          districtMap[newDistrictId][newField] = plan[field][district];
        } else
          districtMap[district]["populations"].push({
            type: castCategory(field),
            count: plan[field][district],
          });
      }
    }

    //add district map to new plan
    //convert district map to an array of objects with an id field equal to their key
    let districtArray = [];
    for (let district in districtMap) {
      districtMap[district]["id"] = district;
      districtArray.push(districtMap[district]);
    }
    newPlan["districts"] = districtArray;
    uniquePlansData["uniqueDistrictPlans"].push(newPlan);
  }
  return uniquePlansData;
}

////////////////////////////////// SMD Parsing //////////////////////////////////
//console.log(getEnsembleSummaryData(rawSMDData, fieldsToAvg));
//console.log(JSON.stringify(getAnalysisData(rawSMDData, fieldsToAnalyze)));
console.log(JSON.stringify(getUniquePlansData(rawSMDData, "North Carolina")));

////////////////////////////////// MMD Parsing //////////////////////////////////
let MMDEnsembles = [];
let MMDAnalysisData = [];

for (let subEnsemble in rawMMDSubEnsembles) {
  //if field contains "unique_plans_data ignore"
  if (subEnsemble === "unique_plans_data") continue;

  let subEnsembleData = rawMMDSubEnsembles[subEnsemble];
  let subEnsemblePattern = subEnsemble;

  let subEnsembleSummaryData = getEnsembleSummaryData(
    subEnsembleData,
    fieldsToAvg,
    subEnsemblePattern,
    "MMD"
  );
  let subEnsembleAnalysisData = getAnalysisData(
    subEnsembleData,
    fieldsToAnalyze,
    subEnsemblePattern
  );
  //push to array
  MMDEnsembles.push(subEnsembleSummaryData);
  MMDAnalysisData.push(subEnsembleAnalysisData);
}
//console.log(JSON.stringify({"MMD": MMDEnsembles}));
//console.log(JSON.stringify({ MMD: MMDAnalysisData }));

console.log();
console.log(
  JSON.stringify(
    getUniquePlansData(rawMMDSubEnsembles, "North Carolina", "MMD")
  )
);
// //print out full object using util.inspect
// let util = require("util");
// console.log(util.inspect(getUniquePlansData(rawMMDSubEnsembles, "North Carolina", "MMD"), false, null, true));
