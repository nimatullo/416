let plans = {
  "democrat split > .90": {
    blk_pop: {
      13: 88133,
      5: 28391,
      9: 264562,
      11: 155279,
      3: 271769,
      1: 193066,
      7: 205404,
      8: 80155,
      10: 172056,
      4: 100531,
      6: 166350,
      12: 105311,
      2: 188847,
    },
    asn_pop: {
      13: 11588,
      5: 5543,
      9: 31597,
      11: 6648,
      3: 4155,
      1: 21434,
      7: 8602,
      8: 11791,
      10: 41503,
      4: 16675,
      6: 29194,
      12: 8409,
      2: 9440,
    },
    hsp_pop: {
      13: 55437,
      5: 40051,
      9: 100870,
      11: 53570,
      3: 38408,
      1: 53149,
      7: 58285,
      8: 42540,
      10: 70845,
      4: 65050,
      6: 77211,
      12: 62952,
      2: 81752,
    },
    wt_pop: {
      13: 575219,
      5: 632178,
      9: 323567,
      11: 503186,
      3: 390158,
      1: 444404,
      7: 436391,
      8: 578219,
      10: 437414,
      4: 538157,
      6: 451202,
      12: 541668,
      2: 372232,
    },
    tot_pop: {
      13: 743605,
      5: 728132,
      9: 739191,
      11: 741431,
      3: 719589,
      1: 728614,
      7: 724880,
      8: 725552,
      10: 739541,
      4: 736065,
      6: 741078,
      12: 730364,
      2: 737441,
    },
    minority_pop: {
      13: 155158,
      5: 73985,
      9: 397029,
      11: 215497,
      3: 314332,
      1: 267649,
      7: 272291,
      8: 134486,
      10: 284404,
      4: 182256,
      6: 272755,
      12: 176672,
      2: 280039,
    },
    dem_split: {
      13: 0.3708088738005988,
      5: 0.4401507401925355,
      9: 0.9078420288831033,
      11: 0.4161509171570157,
      3: 0.49258338699977117,
      1: 0.5516884923606046,
      7: 0.43249765498422443,
      8: 0.3084512285927029,
      10: 0.6631543400216288,
      4: 0.40017984331329276,
      6: 0.633716334833723,
      12: 0.4155401067095049,
      2: 0.46137144070896713,
    },
    rep_split: {
      13: 0.6291911261994012,
      5: 0.5598492598074645,
      9: 0.09215797111689666,
      11: 0.5838490828429843,
      3: 0.5074166130002289,
      1: 0.4483115076393954,
      7: 0.5675023450157756,
      8: 0.6915487714072971,
      10: 0.33684565997837124,
      4: 0.5998201566867073,
      6: 0.36628366516627703,
      12: 0.5844598932904951,
      2: 0.5386285592910329,
    },
    safe_districts: 3,
    opportunity_reps: 1,
    polsby_popper_scores: {
      13: 0.1538087447173587,
      5: 0.1872048333407249,
      9: 0.08451079169659556,
      11: 0.32910256549125816,
      3: 0.14682709879389458,
      1: 0.0930620530800443,
      7: 0.1736142178266138,
      8: 0.12342069513013351,
      10: 0.1250963862121025,
      4: 0.18780575615549142,
      6: 0.3736113237679993,
      12: 0.11726841212599791,
      2: 0.23659785640317038,
    },
  },
  "high opportunity rep count": {
    blk_pop: {
      13: 262111,
      5: 208938,
      9: 30534,
      11: 223255,
      3: 110106,
      1: 150972,
      7: 94667,
      8: 172430,
      10: 158162,
      4: 202957,
      6: 164584,
      12: 129012,
      2: 112126,
    },
    asn_pop: {
      13: 6433,
      5: 10284,
      9: 5607,
      11: 7397,
      3: 14341,
      1: 51109,
      7: 7549,
      8: 16994,
      10: 25765,
      4: 16594,
      6: 23437,
      12: 7800,
      2: 13269,
    },
    hsp_pop: {
      13: 32819,
      5: 69699,
      9: 40760,
      11: 68169,
      3: 45787,
      1: 74395,
      7: 61803,
      8: 88656,
      10: 79001,
      4: 54054,
      6: 72844,
      12: 48971,
      2: 63162,
    },
    wt_pop: {
      13: 426076,
      5: 377072,
      9: 641109,
      11: 423676,
      3: 542677,
      1: 442853,
      7: 547558,
      8: 440563,
      10: 448534,
      4: 444155,
      6: 447182,
      12: 500030,
      2: 542510,
    },
    tot_pop: {
      13: 743370,
      5: 720291,
      9: 740309,
      11: 737916,
      3: 726637,
      1: 737550,
      7: 723238,
      8: 734546,
      10: 728216,
      4: 734138,
      6: 723728,
      12: 741125,
      2: 744419,
    },
    minority_pop: {
      13: 301363,
      5: 288921,
      9: 76901,
      11: 298821,
      3: 170234,
      1: 276476,
      7: 164019,
      8: 278080,
      10: 262928,
      4: 273605,
      6: 260865,
      12: 185783,
      2: 188557,
    },
    dem_split: {
      13: 0.49150109891180926,
      5: 0.5040569818320848,
      9: 0.4383439083398001,
      11: 0.4390061816721621,
      3: 0.4048411150625215,
      1: 0.7018314946409643,
      7: 0.377123136786626,
      8: 0.5690141341510697,
      10: 0.6382832720464835,
      4: 0.5371445614944369,
      6: 0.6124645034453998,
      12: 0.395373744337207,
      2: 0.34919628128236935,
    },
    rep_split: {
      13: 0.5084989010881907,
      5: 0.49594301816791514,
      9: 0.5616560916601999,
      11: 0.5609938183278379,
      3: 0.5951588849374785,
      1: 0.2981685053590358,
      7: 0.622876863213374,
      8: 0.4309858658489302,
      10: 0.36171672795351645,
      4: 0.46285543850556304,
      6: 0.3875354965546002,
      12: 0.6046262556627929,
      2: 0.6508037187176307,
    },
    safe_districts: 1,
    opportunity_reps: 0,
    polsby_popper_scores: {
      13: 0.1538087447173587,
      5: 0.1872048333407249,
      9: 0.08451079169659556,
      11: 0.32910256549125816,
      3: 0.14682709879389458,
      1: 0.0930620530800443,
      7: 0.1736142178266138,
      8: 0.12342069513013351,
      10: 0.1250963862121025,
      4: 0.18780575615549142,
      6: 0.3736113237679993,
      12: 0.11726841212599791,
      2: 0.23659785640317038,
    },
  },
  "high vote seat share skew": {
    blk_pop: {
      13: 97817,
      5: 163081,
      9: 29539,
      11: 156324,
      3: 205517,
      1: 162844,
      7: 267407,
      8: 116032,
      10: 227594,
      4: 75785,
      6: 112177,
      12: 215704,
      2: 190033,
    },
    asn_pop: {
      13: 8222,
      5: 46156,
      9: 5758,
      11: 5447,
      3: 21349,
      1: 23882,
      7: 4959,
      8: 9380,
      10: 29691,
      4: 10633,
      6: 21933,
      12: 10129,
      2: 9040,
    },
    hsp_pop: {
      13: 67396,
      5: 67199,
      9: 40427,
      11: 45841,
      3: 55083,
      1: 80881,
      7: 39959,
      8: 68389,
      10: 80008,
      4: 41776,
      6: 72759,
      12: 86955,
      2: 53447,
    },
    wt_pop: {
      13: 554071,
      5: 453340,
      9: 648211,
      11: 440990,
      3: 432505,
      1: 441574,
      7: 402688,
      8: 518699,
      10: 373496,
      4: 598166,
      6: 499566,
      12: 405792,
      2: 454897,
    },
    tot_pop: {
      13: 741063,
      5: 747453,
      9: 746204,
      11: 727263,
      3: 731455,
      1: 726024,
      7: 730447,
      8: 724683,
      10: 727373,
      4: 739116,
      6: 721710,
      12: 747358,
      2: 725334,
    },
    minority_pop: {
      13: 173435,
      5: 276436,
      9: 75724,
      11: 207612,
      3: 281949,
      1: 267607,
      7: 312325,
      8: 193801,
      10: 337293,
      4: 128194,
      6: 206869,
      12: 312788,
      2: 252520,
    },
    dem_split: {
      13: 0.33323098966328935,
      5: 0.6839364702739651,
      9: 0.43565946408818446,
      11: 0.4235579055607081,
      3: 0.5505398212312945,
      1: 0.6069177623684842,
      7: 0.49779938019240283,
      8: 0.40143329744851053,
      10: 0.8170757557570851,
      4: 0.3201199864381161,
      6: 0.4986838278246375,
      12: 0.47344200630543337,
      2: 0.41667216704308374,
    },
    rep_split: {
      13: 0.6667690103367107,
      5: 0.3160635297260349,
      9: 0.5643405359118155,
      11: 0.576442094439292,
      3: 0.4494601787687054,
      1: 0.3930822376315158,
      7: 0.5022006198075972,
      8: 0.5985667025514895,
      10: 0.1829242442429149,
      4: 0.6798800135618839,
      6: 0.5013161721753625,
      12: 0.5265579936945667,
      2: 0.5833278329569163,
    },
    safe_districts: 4,
    opportunity_reps: 0,
    polsby_popper_scores: {
      13: 0.1538087447173587,
      5: 0.1872048333407249,
      9: 0.08451079169659556,
      11: 0.32910256549125816,
      3: 0.14682709879389458,
      1: 0.0930620530800443,
      7: 0.1736142178266138,
      8: 0.12342069513013351,
      10: 0.1250963862121025,
      4: 0.18780575615549142,
      6: 0.3736113237679993,
      12: 0.11726841212599791,
      2: 0.23659785640317038,
    },
  },
};

function calculateTotalSplit(plan) {
  let dems = 0;
  let reps = 0;
  let totalDistricts = Object.keys(plan["tot_pop"]).length;
  for (let i = 1; i <= totalDistricts; i++) {
    dems += plan.dem_split[i];
    reps += plan.rep_split[i];
  }
  let percent_dem = dems / totalDistricts;
  let percent_rep = reps / totalDistricts;
  return { percent_dem, percent_rep };
}

//print the winning percentage of each party
function printWinningPercentage(plan) {
  //count number of districts won by each party
  let dems = 0;
  let reps = 0;
  let totalDistricts = Object.keys(plan["tot_pop"]).length;
  for (let i = 1; i <= totalDistricts; i++) {
    if (plan.dem_split[i] > plan.rep_split[i]) {
      dems++;
    } else {
      reps++;
    }
  }
  let percent_dem = dems / totalDistricts;
  let percent_rep = reps / totalDistricts;
  console.log("Democrats won " + percent_dem * 100 + "% of districts");
  console.log("Republicans won " + percent_rep * 100 + "% of districts");
}

function calculateAveragePolsbyPopper(plan) {
  let totalScore = 0;
  let totalDistricts = Object.keys(plan["tot_pop"]).length;
  for (let i = 1; i <= totalDistricts; i++) {
    totalScore += plan.polsby_popper_scores[i];
  }
  return totalScore / totalDistricts;
}

function castCategory(category) {
  switch (category) {
    case "wt_pop":
      return "WHITE";
    case "blk_pop":
      return "BLACK";
    case "hsp_pop":
      return "HISPANIC";
    case "asn_pop":
      return "ASIAN";
    case "Other":
      return "ignore";
  }
}

function calculateTotalPops(plan) {
  let totalDistricts = Object.keys(plan["tot_pop"]).length;
  let categories = ["wt_pop", "blk_pop", "hsp_pop", "asn_pop"];
  let totalPopsByCategory = [];
  for (let i = 0; i < categories.length; i++) {
    let totalPop = 0;
    for (let j = 1; j <= totalDistricts; j++) {
      totalPop += plan[categories[i]][j];
    }
    totalPopsByCategory.push({
      type: castCategory(categories[i]),
      count: totalPop,
    });
  }

  return totalPopsByCategory;
}

function generateDistricts(plan) {
  let totalDistricts = Object.keys(plan["tot_pop"]).length;
  let categories = ["wt_pop", "blk_pop", "hsp_pop", "asn_pop"];
  let popsByDistrict = [];
  for (let i = 1; i <= totalDistricts; i++) {
    let district = {};
    district["id"] = i;
    let pops = [];
    for (let j = 0; j < categories.length; j++) {
      pops.push({
        type: castCategory(categories[j]),
        count: plan[categories[j]][i],
      });
    }
    district["populations"] = pops;
    popsByDistrict.push(district);
  }
  return popsByDistrict;
}

function zipSplits(plan) {
  let totalDistricts = Object.keys(plan["tot_pop"]).length;
  let districts = [];
  for (let i = 1; i <= totalDistricts; i++) {
    districts.push([plan.dem_splits[i], plan.rep_splits[i]]);
  }
  return districts;
}

function generateNewPlan(plan, state, type, desc) {
  let splits = calculateTotalSplit(plan);
  let percentDem = splits.percent_dem;
  let percentRep = splits.percent_rep;
  let overview = {
    state: state,
    populations: calculateTotalPops(plan),
    percentDem: percentDem,
    percentRep: percentRep,
    opportunityDistricts: plan.opportunity_reps,
    safeDistricts: plan.safe_districts,
    polsbyPopperScore: calculateAveragePolsbyPopper(plan),
  };
  let districts = generateDistricts(plan);

  return {
    description: desc,
    overview: overview,
    districts: districts,
    type: type,
  };
}

function generateNewPlans(plans, state, type) {
  let newPlans = [];
  for (let key in plans) {
    printWinningPercentage(plans[key]);
    console.log();
    //newPlans.push(generateNewPlan(plans[key], state, type, key));
  }
  return newPlans;
}

let newPlans = generateNewPlans(plans, "North Carolina", "SMD");
